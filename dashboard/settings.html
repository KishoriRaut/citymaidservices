<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings - City Maid</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- Supabase Configuration -->
    <script src="supabase-config.js"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'brand-primary': '#0056B3',
                        'brand-secondary': '#003D82',
                        'brand-light': '#E6F0FF'
                    },
                    fontFamily: {
                        'sans': ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-100">
    <div class="flex h-screen overflow-hidden">
        <!-- Sidebar -->
        <aside class="hidden md:flex md:flex-shrink-0">
            <div class="flex flex-col w-64">
                <div class="flex flex-col flex-grow pt-5 overflow-y-auto bg-white border-r">
                    <div class="flex flex-col flex-shrink-0 px-4">
                        <a href="../index.html" class="text-3xl font-bold text-brand-primary tracking-tight">City<span class="text-brand-secondary">Maid</span></a>
                    </div>
                    <div class="flex flex-col flex-grow px-4 mt-5">
                        <nav class="flex-1 space-y-1">
                            <a href="admin-dashboard.html" class="flex items-center px-4 py-2 text-sm font-medium rounded-lg hover:bg-brand-light group">
                                <i class="fas fa-chart-line mr-3 text-brand-primary"></i>
                                Dashboard
                            </a>
                            <a href="manage-users.html" class="flex items-center px-4 py-2 text-sm font-medium rounded-lg hover:bg-brand-light group">
                                <i class="fas fa-users mr-3 text-brand-primary"></i>
                                Manage Users
                            </a>
                            <a href="manage-jobs.html" class="flex items-center px-4 py-2 text-sm font-medium rounded-lg hover:bg-brand-light group">
                                <i class="fas fa-briefcase mr-3 text-brand-primary"></i>
                                Manage Jobs
                            </a>
                            <a href="manage-maids.html" class="flex items-center px-4 py-2 text-sm font-medium rounded-lg hover:bg-brand-light group">
                                <i class="fas fa-broom mr-3 text-brand-primary"></i>
                                Manage Maids
                            </a>
                            <a href="manage-payments.html" class="flex items-center px-4 py-2 text-sm font-medium rounded-lg hover:bg-brand-light group">
                                <i class="fas fa-credit-card mr-3 text-brand-primary"></i>
                                Manage Payments
                            </a>
                            <a href="settings.html" class="flex items-center px-4 py-2 text-sm font-medium rounded-lg bg-brand-light text-brand-primary group">
                                <i class="fas fa-cog mr-3"></i>
                                Settings
                            </a>
                        </nav>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main content area -->
        <div class="flex flex-col flex-1 overflow-hidden">
            <!-- Top bar -->
            <header class="flex-shrink-0 relative h-16 bg-white flex items-center shadow-sm">
                <button type="button" class="px-4 text-gray-500 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-brand-primary md:hidden" id="mobile-menu-button">
                    <span class="sr-only">Open sidebar</span>
                    <i class="fas fa-bars h-6 w-6"></i>
                </button>

                <div class="flex-1 px-4 flex justify-between">
                    <div class="flex-1 flex">
                        <h1 class="text-2xl font-semibold text-gray-900">Settings</h1>
                    </div>
                </div>
            </header>

            <!-- Main content -->
            <main class="flex-1 relative overflow-y-auto focus:outline-none">
                <div class="py-6">
                    <div class="max-w-7xl mx-auto px-4 sm:px-6 md:px-8">
                        <!-- Settings Sections -->
                        <div class="space-y-6">
                            <!-- Platform Settings -->
                            <div class="bg-white shadow rounded-lg">
                                <div class="px-4 py-5 sm:p-6">
                                    <h3 class="text-lg leading-6 font-medium text-gray-900">Platform Settings</h3>
                                    <div class="mt-5 space-y-4">
                                        <div>
                                            <label for="contact-unlock-fee" class="block text-sm font-medium text-gray-700">Contact Unlock Fee ($)</label>
                                            <input type="number" id="contact-unlock-fee" name="contact-unlock-fee" 
                                                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-brand-primary focus:ring-brand-primary sm:text-sm"
                                                value="5.00">
                                        </div>
                                        <div>
                                            <label for="max-active-listings" class="block text-sm font-medium text-gray-700">Maximum Active Listings per User</label>
                                            <input type="number" id="max-active-listings" name="max-active-listings" 
                                                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-brand-primary focus:ring-brand-primary sm:text-sm"
                                                value="3">
                                        </div>
                                        <div>
                                            <label for="listing-duration" class="block text-sm font-medium text-gray-700">Listing Duration (days)</label>
                                            <input type="number" id="listing-duration" name="listing-duration" 
                                                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-brand-primary focus:ring-brand-primary sm:text-sm"
                                                value="30">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Payment Settings -->
                            <div class="bg-white shadow rounded-lg">
                                <div class="px-4 py-5 sm:p-6">
                                    <h3 class="text-lg leading-6 font-medium text-gray-900">Payment Settings</h3>
                                    <div class="mt-5 space-y-4">
                                        <div>
                                            <label for="stripe-public-key" class="block text-sm font-medium text-gray-700">Stripe Public Key</label>
                                            <input type="text" id="stripe-public-key" name="stripe-public-key" 
                                                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-brand-primary focus:ring-brand-primary sm:text-sm"
                                                value="pk_test_...">
                                        </div>
                                        <div>
                                            <label for="stripe-secret-key" class="block text-sm font-medium text-gray-700">Stripe Secret Key</label>
                                            <input type="password" id="stripe-secret-key" name="stripe-secret-key" 
                                                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-brand-primary focus:ring-brand-primary sm:text-sm"
                                                value="sk_test_...">
                                        </div>
                                        <div>
                                            <label for="currency" class="block text-sm font-medium text-gray-700">Currency</label>
                                            <select id="currency" name="currency" 
                                                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-brand-primary focus:ring-brand-primary sm:text-sm">
                                                <option value="USD">USD ($)</option>
                                                <option value="EUR">EUR (€)</option>
                                                <option value="GBP">GBP (£)</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Email Settings -->
                            <div class="bg-white shadow rounded-lg">
                                <div class="px-4 py-5 sm:p-6">
                                    <h3 class="text-lg leading-6 font-medium text-gray-900">Email Settings</h3>
                                    <div class="mt-5 space-y-4">
                                        <div>
                                            <label for="smtp-host" class="block text-sm font-medium text-gray-700">SMTP Host</label>
                                            <input type="text" id="smtp-host" name="smtp-host" 
                                                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-brand-primary focus:ring-brand-primary sm:text-sm"
                                                value="smtp.gmail.com">
                                        </div>
                                        <div>
                                            <label for="smtp-port" class="block text-sm font-medium text-gray-700">SMTP Port</label>
                                            <input type="number" id="smtp-port" name="smtp-port" 
                                                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-brand-primary focus:ring-brand-primary sm:text-sm"
                                                value="587">
                                        </div>
                                        <div>
                                            <label for="smtp-username" class="block text-sm font-medium text-gray-700">SMTP Username</label>
                                            <input type="email" id="smtp-username" name="smtp-username" 
                                                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-brand-primary focus:ring-brand-primary sm:text-sm"
                                                value="noreply@citymaid.com">
                                        </div>
                                        <div>
                                            <label for="smtp-password" class="block text-sm font-medium text-gray-700">SMTP Password</label>
                                            <input type="password" id="smtp-password" name="smtp-password" 
                                                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-brand-primary focus:ring-brand-primary sm:text-sm"
                                                value="********">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Save Button -->
                            <div class="flex justify-end">
                                <button type="button" onclick="saveSettings()" 
                                    class="inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-brand-primary hover:bg-brand-secondary focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-primary">
                                    <i class="fas fa-save mr-2"></i>
                                    Save Settings
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script>
        // Initialize page
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('Settings page loaded');
            
            // Initialize Supabase client
            if (!window.supabaseClient) {
                try {
                    console.log('Initializing Supabase client...');
                    window.supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
                    console.log('Supabase client initialized successfully');
                } catch (error) {
                    console.error('Error initializing Supabase client:', error);
                    showErrorMessage('Failed to initialize database connection');
                    return;
                }
            }

            // Load current settings
            await loadSettings();
        });

        // Function to load settings from Supabase
        async function loadSettings() {
            try {
                const { data: settings, error } = await supabaseClient
                    .from('settings')
                    .select('*')
                    .single();

                if (error) throw error;

                if (settings) {
                    // Update form fields with loaded settings
                    document.getElementById('contact-unlock-fee').value = settings.contact_unlock_fee || 5.00;
                    document.getElementById('max-active-listings').value = settings.max_active_listings || 3;
                    document.getElementById('listing-duration').value = settings.listing_duration || 30;
                    document.getElementById('stripe-public-key').value = settings.stripe_public_key || '';
                    document.getElementById('stripe-secret-key').value = settings.stripe_secret_key || '';
                    document.getElementById('currency').value = settings.currency || 'USD';
                    document.getElementById('smtp-host').value = settings.smtp_host || '';
                    document.getElementById('smtp-port').value = settings.smtp_port || 587;
                    document.getElementById('smtp-username').value = settings.smtp_username || '';
                    document.getElementById('smtp-password').value = settings.smtp_password || '';
                }
            } catch (error) {
                console.error('Error loading settings:', error);
                showErrorMessage('Failed to load settings');
            }
        }

        // Function to save settings to Supabase
        async function saveSettings() {
            try {
                const settings = {
                    contact_unlock_fee: parseFloat(document.getElementById('contact-unlock-fee').value),
                    max_active_listings: parseInt(document.getElementById('max-active-listings').value),
                    listing_duration: parseInt(document.getElementById('listing-duration').value),
                    stripe_public_key: document.getElementById('stripe-public-key').value,
                    stripe_secret_key: document.getElementById('stripe-secret-key').value,
                    currency: document.getElementById('currency').value,
                    smtp_host: document.getElementById('smtp-host').value,
                    smtp_port: parseInt(document.getElementById('smtp-port').value),
                    smtp_username: document.getElementById('smtp-username').value,
                    smtp_password: document.getElementById('smtp-password').value,
                    updated_at: new Date().toISOString()
                };

                const { error } = await supabaseClient
                    .from('settings')
                    .upsert(settings);

                if (error) throw error;

                showSuccessMessage('Settings saved successfully');
            } catch (error) {
                console.error('Error saving settings:', error);
                showErrorMessage('Failed to save settings');
            }
        }

        // Function to show error message
        function showErrorMessage(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'fixed top-4 right-4 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded';
            errorDiv.role = 'alert';
            errorDiv.innerHTML = `
                <strong class="font-bold">Error!</strong>
                <span class="block sm:inline">${message}</span>
            `;
            document.body.appendChild(errorDiv);
            setTimeout(() => {
                errorDiv.remove();
            }, 5000);
        }

        // Function to show success message
        function showSuccessMessage(message) {
            const successDiv = document.createElement('div');
            successDiv.className = 'fixed top-4 right-4 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded';
            successDiv.role = 'alert';
            successDiv.innerHTML = `
                <strong class="font-bold">Success!</strong>
                <span class="block sm:inline">${message}</span>
            `;
            document.body.appendChild(successDiv);
            setTimeout(() => {
                successDiv.remove();
            }, 5000);
        }
    </script>
</body>
</html> 